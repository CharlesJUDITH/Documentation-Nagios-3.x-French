<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd"
[
  <!ENTITY % all.entities SYSTEM "../all-entities.ent">
  %all.entities;
]
>
<chapter id="gettingstarted-quickstart-fedora" xreflabel="Fedora quickstart">
  <title>&name-fedora; Quickstart</title>

  <abstract>
    <para>
    This guide is intended to provide you with simple instructions on how to 
install Nagios from source (code) on &name-fedora; and have it monitoring 
your local machine inside of 20 minutes. No advanced installation options 
are discussed here - just the basics that will work for 95% of users who 
want to get started.
    </para>

    <para>
    These instructions were written based on a standard &name-fedora; Core 6 
Linux distribution.
    </para>
  </abstract>

  <section>
    <title>What You'll End Up With</title>

    <para>
    If you follow these instructions, here's what you'll end up with:
    </para>

    <itemizedlist>
      <listitem>
        <para>
	Nagios and the plugins will be installed underneath <filename 
class="directory">/usr/local/nagios</filename>
	</para>
      </listitem>

      <listitem>
        <para>
	Nagios will be configured to monitor a few aspects of your local system (CPU 
load, disk usage, etc.)
	</para>
      </listitem>

      <listitem>
        <para>
	The Nagios web interface will be accessible at
        <uri>http://localhost/nagios/</uri>
	</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Prerequisites</title>

    <para>
    During portions of the installation you'll need to have root access to your 
machine.
    </para>

    <para>
    Make sure you've installed the following packages on your &name-fedora; 
installation before continuing.
    </para>

    <itemizedlist>
      <listitem>
        <para>Apache</para>
      </listitem>
      <listitem>
        <para>GCC compiler</para>
      </listitem>
      <listitem>
        <para><ulink url="&url-gd;">GD</ulink> development libraries</para>
      </listitem>
    </itemizedlist>

    <para>
    You can use <command>yum</command> to install these packages by running the 
following commands (as root):
    </para>

    <screen>
<prompt>linux:~ # </prompt><userinput>yum install httpd</userinput>
<prompt>linux:~ # </prompt><userinput>yum install gcc</userinput>
<prompt>linux:~ # </prompt><userinput>yum install glibc glibc-common</userinput>
<prompt>linux:~ # </prompt><userinput>yum install gd gd-devel</userinput>
</screen>
  </section>

  <section>
    <title>Créez un compte utilisateur</title>

    <para>Passez sur le compte root.</para>

    <screen>
<prompt>linux:~ $ </prompt><userinput>su -l</userinput>
</screen>

    <para>Créez un utilisateur nagios et attribuez lui un mot de passe.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>/usr/sbin/useradd -m nagios</userinput>
<prompt>linux:~ # </prompt><userinput>passwd nagios</userinput>
</screen>

    <para>Créez un groupe nagcmd pour autoriser la soumission de commandes externes 
depuis l'interface web. Ajoutez à la fois l'utilisateur nagios et 
l'utilisateur apache à ce groupe.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>/usr/sbin/groupadd nagcmd</userinput>
<prompt>linux:~ # </prompt><userinput>/usr/sbin/usermod -G nagcmd nagios</userinput>
<prompt>linux:~ # </prompt><userinput>/usr/sbin/usermod -G nagcmd apache</userinput>
</screen>
  </section>

  <section>
    <title>Téléchargez Nagios et les Plugins.</title>

    <para>Créez un répertoire pour stocker les téléchargements.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>mkdir ~/downloads</userinput>
<prompt>linux:~ # </prompt><userinput>cd ~/downloads</userinput>
</screen>

    <para>
    Téléchargez à la fois l'archive du code source de Nagios et des plugins 
Nagios (visitez <ulink 
url="&url-nagios;download/">&url-nagios;download/</ulink> pour les liens 
vers les dernières versions). Au moment de la rédaction, les dernières 
versions de Nagios et des plugins Nagios étaient respectivement  la 3.0.3 et 
la 1.4.11.
    </para>

    <screen>
<prompt>linux:~ # </prompt><userinput>wget http://osdn.dl.sourceforge.net/sourceforge/nagios/nagios-3.0.2.tar.gz</userinput>
<prompt>linux:~ # </prompt><userinput>wget http://osdn.dl.sourceforge.net/sourceforge/nagiosplug/nagios-plugins-1.4.11.tar.gz</userinput>
</screen>
  </section>

  <section>
    <title>Compilez et installez Nagios</title>

    <para>Extraire le code source de Nagios de l'archive.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>cd ~/downloads</userinput>
<prompt>linux:~ # </prompt><userinput>tar xzf nagios-3.0.2.tar.gz</userinput>
<prompt>linux:~ # </prompt><userinput>cd nagios-3.0.2</userinput>
</screen>

    <para>Exécutez le script de configuration de Nagios en lui passant le nom du 
groupe que vous venez juste de créer comme suit:</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>./configure --with-command-group=nagcmd</userinput>
</screen>

    <para>Compilez le code source de Nagios.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>make all</userinput>
</screen>

    <para>Installez les binaires, les scripts de démarrage, les fichiers de 
configuration fournis en exemple et réglez les permissions sur le dossier 
des commandes externes.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>make install</userinput>
<prompt>linux:~ # </prompt><userinput>make install-init</userinput>
<prompt>linux:~ # </prompt><userinput>make install-config</userinput>
<prompt>linux:~ # </prompt><userinput>make install-commandmode</userinput>
</screen>

    <para>Don't start Nagios yet - there's still more that needs to be done&hellip;</para>
  </section>

  <section>
    <title>Customisez la configuration</title>

    <para>Les exemples de <link linkend="configuringnagios-config">fichiers de 
configuration</link> ont été installé dans le répertoire <filename 
class="directory">/usr/local/nagios/etc</filename>. Ces fichiers d'exemple 
devraient suffire pour commencer avec Nagios. Vous n'aurez qu'une chose à 
modifier avant de pouvoir commencer...</para>

    <para>Éditez le fichier de configuration 
<filename>/usr/local/nagios/etc/objects/contacts.cfg</filename> avec votre 
éditeur de texte préféré et changez l'adresse de courrier électronique 
associée avec la définition de contact nagiosadmin par celle que vous 
souhaitez utiliser pour recevoir les alertes.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>vi /usr/local/nagios/etc/objects/contacts.cfg</userinput>
</screen>
  </section>

  <section>
    <title>Condfiguration de l'interface Web</title>

    <para>Install the Nagios web config file in the Apache <filename 
class="directory">conf.d</filename> directory.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>make install-webconf</userinput>
</screen>

    <para>Create a nagiosadmin account for logging into the Nagios web 
interface. Remember the password you assign to this 
account&nbsp;-&nbsp;you'll need it later.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin</userinput>
</screen>

    <para>Redémmarez Apache pour que les nouveaux réglages prennent effet.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>service httpd restart</userinput>
</screen>
  </section>

  <section>
    <title>Compilation et installation des Plugins Nagios</title>

    <para>Extraire le code source des plugins Nagios de l'archive.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>cd ~/downloads</userinput>
<prompt>linux:~ # </prompt><userinput>tar xzf nagios-plugins-1.4.11.tar.gz</userinput>
<prompt>linux:~ # </prompt><userinput>cd nagios-plugins-1.4.11</userinput>
</screen>

    <para>Compilation et installation des plugins.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>./configure --with-nagios-user=nagios --with-nagios-group=nagios</userinput>
<prompt>linux:~ # </prompt><userinput>make</userinput>
<prompt>linux:~ # </prompt><userinput>make install</userinput>
</screen>
  </section>

  <section>
    <title>Démarrage de Nagios</title>

    <para>Ajouter Nagios à la liste des services système et démarrer le 
automatiquement au démarrage du système.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>chkconfig --add nagios</userinput>
<prompt>linux:~ # </prompt><userinput>chkconfig nagios on</userinput>
</screen>

    <para>Vérifier les exemples de fichiers de configuration de Nagios. </para>

    <screen>
<prompt>linux:~ # </prompt><userinput>/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg</userinput>
</screen>

    <para>S'il n'y a pas d'erreur, démarrer Nagios.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>service nagios start</userinput>
</screen>
  </section>

  <section>
    <title>Modify SELinux Settings</title>

    <para>&name-fedora; ships with SELinux (Security Enhanced Linux) installed and in 
Enforcing mode by default. This can result in <errorname>Internal Server 
Error</errorname> messages when you attempt to access the Nagios CGIs.</para>

    <para>See if SELinux is in Enforcing mode.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>getenforce</userinput>
</screen>

    <para>Put SELinux into Permissive mode.</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>setenforce 0</userinput>
</screen>

    <para>To make this change permanent, you'll have to modify the settings in 
<filename>/etc/selinux/config</filename> and reboot.</para>

    <para>Instead of disabling SELinux or setting it to permissive mode, you can use 
the following command to run the CGIs under SELinux enforcing/targeted mode:</para>

    <screen>
<prompt>linux:~ # </prompt><userinput>chcon -R -t httpd_sys_content_t /usr/local/nagios/sbin/</userinput>
<prompt>linux:~ # </prompt><userinput>chcon -R -t httpd_sys_content_t /usr/local/nagios/share/</userinput>
</screen>

    <para>For information on running the Nagios CGIs under Enforcing mode with a 
targeted policy, visit the NagiosCommunity.org wiki at <ulink 
url="&url-nagios-community;">&url-nagios-community;</ulink>.</para>
  </section>

  <section>
    <title>Connexion à l'interface Web</title>

    <para>Vous devriez maintenant pouvoir vous connecter à l'interface web de Nagios à 
l'adresse ci-dessous.Il vous sera demandé un nom d'utilisateur (nagiosadmin) 
et le mot de passe que vous avez spécifié plus tôt.</para>

    <para>http://localhost/nagios/</para>

    <para>Cliquez sur le lien <guimenuitem>Service Detail</guimenuitem> de la barre de 
navigation pour voir les détails de ce que vous supervisez sur votre machine 
locale. Nagios va prendre quelques minutes pour contrôler l'ensemble des 
services de votre machine du fait que les contrôles sont répartis dans le 
temps.</para>
  </section>

  <section>
    <title>Autres Modifications</title>

    <para>Assurez-vous que les règles du pare-feu de la machine sont configurées pour 
autoriser l'accès au serveur web si vous souhaitez accéder à distance à 
l'interface de Nagios.</para>

    <para>Configuring email notifications is out of the scope of this 
documentation. While Nagios is currently configured to send you email 
notifications, your system may not yet have a mail program properly 
installed or configured. Refer to your system documentation, search the web, 
or look to the <ulink url="&url-nagios-community;">NagiosCommunity.org 
wiki</ulink> for specific instructions on configuring your system to send 
email messages to external addresses. More information on notifications can 
be found <link linkend="thebasics-notifications">here</link>.</para>
  </section>

  <section>
    <title>You're Done</title>

    <para>Congratulations! You sucessfully installed Nagios. Your journey into 
monitoring is just beginning. You'll no doubt want to monitor more than just 
your local machine, so check out the following docs...</para>

    <itemizedlist>
      <listitem>
        <para><link linkend="gettingstarted-monitoring-windows">Monitoring Windows 
machines</link></para>
      </listitem>

      <listitem>
        <para><link linkend="gettingstarted-monitoring-linux">Monitoring Linux/Unix 
machines</link></para>
      </listitem>

      <listitem>
        <para><link linkend="gettingstarted-monitoring-netware">Monitoring Netware 
servers</link></para>
      </listitem>

      <listitem>
        <para><link linkend="gettingstarted-monitoring-routers">Monitoring 
routers/switches</link></para>
      </listitem>

      <listitem>
        <para><link linkend="gettingstarted-monitoring-publicservices">Monitoring publicly 
available services (&protocol-http;, &protocol-ftp;, &protocol-ssh;, 
etc.)</link></para>
      </listitem>
    </itemizedlist>
  </section>
</chapter>

