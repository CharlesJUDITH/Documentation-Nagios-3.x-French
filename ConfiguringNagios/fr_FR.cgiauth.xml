<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd"
[
  <!ENTITY % all.entities SYSTEM "../all-entities.ent">
  %all.entities;
]
>
<chapter id="configuringnagios-cgiauth"
         xreflabel="Authentication and Authorization in The CGIs">
  <title>Authentication And Authorization In The CGIs</title>

  <section>
    <title>Introduction</title>

    <para>This documentation describes how the Nagios CGIs decide who has access to 
view monitoring and configuration information, and who can submit commands 
to the Nagios daemon through the web interface.</para>
  </section>

  <section>
    <title><anchor id="configuringnagios-cgiauth-definitions" />Definitions</title>

    <para>Before continuing, it is important that you understand the meaning of and 
difference between authenticated users and authenticated contacts:</para>

    <itemizedlist>
      <listitem>
        <para>An authenticated user is an someone who has authenticated to the web server 
with a username and password and has been granted access to the Nagios web 
interface.</para>
      </listitem>

      <listitem>
        <para>An authenticated contact is an authenticated user whose username matches the 
short name of a <link 
linkend="configuringnagios-objectdefinitions-contact">contact 
definition</link>.</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title><anchor id="configuringnagios-cgiauth-config_web_users" />Setting Up 
Authenticated Users</title>

    <para>Assuming you configured your web server as described in the <xref 
linkend="gettingstarted-quickstart" />quickstart guide, it should require 
that you authenticate before accessing the Nagios CGIs. You should also have 
one user account (nagiosadmin) that can access the CGIs.</para>

    <para>As you define more <link 
linkend="configuringnagios-objectdefinitions-contact">contacts</link> for 
receiving host and service notifications, you'll most likely want to let 
them access the Nagios web interface. You can use the following command to 
add additional users who can authenticate to the CGIs. Replace 
&lt;username&gt; with the actual username you want to add. In most cases, 
the username should match the short name of a <link 
linkend="configuringnagios-objectdefinitions-contact">contact</link> that 
has been defined.<screen><prompt>linux:~ # </prompt><userinput>htpasswd /usr/local/nagios/etc/htpasswd.users <replaceable>&lt;username&gt;</replaceable></userinput></screen>
    </para>
  </section>

  <section>
    <title><anchor id="configuringnagios-cgiauth-enable_cgi_auth" />Enabling 
Authentication/Authorization Functionality In The CGIs</title>

    <para>The next thing you need to do is make sure that the CGIs are configured to 
use the authentication and authorization functionality in determining what 
information and/or commands users have access to. This is done be setting 
the <link 
linkend="configuringnagios-configcgi-use_authentication">use_authentication</link> 
variable in the <xref linkend="configuringnagios-configcgi" />CGI 
configuration file to a non-zero value. Example:</para>

    <programlisting>use_authentication=1</programlisting>

    <para>Okay, you're now done with setting up basic authentication/authorization 
functionality in the CGIs.</para>
  </section>

  <section>
    <title><anchor id="configuringnagios-cgiauth-default_rights" />Default Permissions 
To CGI Information</title>

    <para>So what default permissions do users have in the CGIs by default when the 
authentication/authorization functionality is enabled?</para>

    <informaltable frame="all">
      <tgroup cols="3">
        <thead>
          <row>
            <entry><para>CGI Data</para></entry>

            <entry><para>Authenticated Contacts<link 
linkend="configuringnagios-cgiauth-definitions">*</link>
            </para></entry>

            <entry><para>Other Authenticated Users<link 
linkend="configuringnagios-cgiauth-definitions">*</link>
            </para></entry>
          </row>
		</thead>
		<tbody>
          <row>
            <entry><para>Host Status Information</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Host Configuration Information</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Host History</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Host Notifications</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Host Commands</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Service Status Information</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Service Configuration Information</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Service History</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Service Notifications</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>Service Commands</para></entry>

            <entry><para>Yes</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>All Configuration Information</para></entry>

            <entry><para>No</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>System/Process Information</para></entry>

            <entry><para>No</para></entry>

            <entry><para>No</para></entry>
          </row>

          <row>
            <entry><para>System/Process Commands</para></entry>

            <entry><para>No</para></entry>

            <entry><para>No</para></entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>

    <para>Authenticated contacts<link 
linkend="configuringnagios-cgiauth-definitions">*</link> are granted the 
following permissions for each service for which they are contacts (but not 
for services for which they are not contacts)...</para>

    <itemizedlist>
      <listitem>
        <para>Authorization to view service status information</para>
      </listitem>

      <listitem>
        <para>Authorization to view service configuration information</para>
      </listitem>

      <listitem>
        <para>Authorization to view history and notifications for the service</para>
      </listitem>

      <listitem>
        <para>Authorization to issue service commands</para>
      </listitem>
    </itemizedlist>

    <para>Authenticated contacts<link 
linkend="configuringnagios-cgiauth-definitions">*</link> are granted the 
following permissions for each host for which they are contacts (but not for 
hosts for which they are not contacts)...</para>

    <itemizedlist>
      <listitem>
        <para>Authorization to view host status information</para>
      </listitem>

      <listitem>
        <para>Authorization to view host configuration information</para>
      </listitem>

      <listitem>
        <para>Authorization to view history and notifications for the host</para>
      </listitem>

      <listitem>
        <para>Authorization to issue host commands</para>
      </listitem>

      <listitem>
        <para>Authorization to view status information for all services on the host</para>
      </listitem>

      <listitem>
        <para>Authorization to view configuration information for all services on the host</para>
      </listitem>

      <listitem>
        <para>Authorization to view history and notification information for all services 
on the host</para>
      </listitem>

      <listitem>
        <para>Authorization to issue commands for all services on the host</para>
      </listitem>
    </itemizedlist>

    <para>It is important to note that by default no one is authorized for the 
following...</para>

    <itemizedlist>
      <listitem>
        <para>Viewing the raw log file via the <link 
linkend="thebasics-cgis-showlog_cgi">showlog CGI</link></para>
      </listitem>

      <listitem>
        <para>Viewing Nagios process information via the <link 
linkend="thebasics-cgis-extinfo_cgi">extended information CGI</link></para>
      </listitem>

      <listitem>
        <para>Issuing Nagios process commands via the <link 
linkend="thebasics-cgis-cmd_cgi">command CGI</link></para>
      </listitem>

      <listitem>
        <para>Viewing host group, contact, contact group, time period, and command 
definitions via the <link linkend="thebasics-cgis-config_cgi">configuration 
CGI</link></para>
      </listitem>
    </itemizedlist>

    <para>You will undoubtably want to access this information, so you'll have to 
assign additional rights for yourself (and possibly other users) as 
described below...</para>
  </section>

  <section>
    <title><anchor id="configuringnagios-cgiauth-additional_rights" />Granting 
Additional Permissions To CGI Information</title>

    <para>You can grant authenticated contacts or other authenticated users permission 
to additional information in the CGIs by adding them to various 
authorization variables in the <link 
linkend="configuringnagios-configcgi">CGI configuration file</link>. I 
realize that the available options don't allow for getting really specific 
about particular permissions, but its better than nothing..</para>

    <para>Additional authorization can be given to users by adding them to the 
following variables in the CGI configuration file...</para>

    <itemizedlist>
      <listitem>
        <para><link 
linkend="configuringnagios-configcgi-authorized_for_system_information">authorized_for_system_information</link></para>
      </listitem>

      <listitem>
        <para><link 
linkend="configuringnagios-configcgi-authorized_for_system_commands">authorized_for_system_commands</link></para>
      </listitem>

      <listitem>
        <para><link 
linkend="configuringnagios-configcgi-authorized_for_configuration_information">authorized_for_configuration_information</link></para>
      </listitem>

      <listitem>
        <para><link 
linkend="configuringnagios-configcgi-authorized_for_all_hosts">authorized_for_all_hosts</link></para>
      </listitem>

      <listitem>
        <para><link 
linkend="configuringnagios-configcgi-authorized_for_all_host_commands">authorized_for_all_host_commands</link></para>
      </listitem>

      <listitem>
        <para><link 
linkend="configuringnagios-configcgi-authorized_for_all_services">authorized_for_all_services</link></para>
      </listitem>

      <listitem>
        <para><link 
linkend="configuringnagios-configcgi-authorized_for_all_service_commands">authorized_for_all_service_commands</link></para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title><anchor id="configuringnagios-cgiauth-cgi_auth_requirements" />CGI 
Authorization Requirements</title>

    <para>If you are confused about the authorization needed to access various 
information in the CGIs, read the Authorization Requirements section for 
each CGI as described <link linkend="thebasics-cgis">here</link>.</para>
  </section>

  <section>
    <title><anchor id="configuringnagios-cgiauth-secure_web_servers" />Authentication 
On Secured Web Servers</title>

    <para>If your web server is located in a secure domain (i.e., behind a firewall) 
or if you are using SSL, you can define a default username that can be used 
to access the CGIs. This is done by defining the <link 
linkend="configuringnagios-configcgi-default_user_name">default_user_name</link> 
option in the <link linkend="configuringnagios-configcgi">CGI configuration 
file</link>. By defining a default username that can access the CGIs, you 
can allow users to access the CGIs without necessarily having to 
authenticate to the web server. You may want to use this to avoid having to 
use basic web authentication, as basic authentication transmits passwords in 
clear text over the Internet.</para>

    <important>
      <para>Do not define a default username unless you are running a secure web server 
and are sure that everyone who has access to the CGIs has been authenticated 
in some manner. If you define this variable, anyone who has not 
authenticated to the web server will inherit all rights you assign to this 
user!</para>
    </important>
  </section>
</chapter>
